# ============================================
# Mercado Esperto - Environment Configuration
# ============================================

# App
DEBUG=false
APP_NAME=Mercado Esperto API

# Database (PostgreSQL)
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://user:pass@postgres:5432/db
# Set to true to see SQL queries in logs (useful for debugging)
DB_ECHO=false

# PostgreSQL credentials (for docker-compose)
POSTGRES_USER=user
POSTGRES_PASSWORD=pass
POSTGRES_DB=db

# JWT Authentication
# Generate a strong secret key: openssl rand -hex 32
SECRET_KEY=your-super-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# ============================================
# AI/LLM Providers (Configure at least one)
# ============================================

# OpenAI API - Get your key at: https://platform.openai.com/api-keys
# OPENAI_API_KEY=sk-your-openai-api-key

# Google Gemini API - Get your key at: https://makersuite.google.com/app/apikey
# GEMINI_API_KEY=your-gemini-api-key
# GEMINI_MODEL=gemini-1.5-flash

# Anthropic Claude API - Get your key at: https://console.anthropic.com/
# Available models: claude-3-5-sonnet-20241022, claude-3-haiku-20240307, claude-3-opus-20240229
# ANTHROPIC_API_KEY=your-anthropic-api-key
# ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# OpenRouter API - Get your key at: https://openrouter.ai/keys
# Allows testing many models (Gemini, Claude, GPT, Llama, etc.) with a single API key
# See available models: https://openrouter.ai/models
# OPENROUTER_API_KEY=sk-or-v1-your-openrouter-api-key
# OPENROUTER_MODEL=google/gemini-2.0-flash-001
# OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# ============================================
# Cache & External Services
# ============================================

# Redis connection string
REDIS_URL=redis://redis:6379/0

# Sefaz (Brazilian Tax Authority) - NFC-e consultation
SEFAZ_API_URL=https://www.nfce.fazenda.sp.gov.br/NFCeConsultaPublica

# CORS - Allowed origins (comma-separated)
# For production, add your frontend domain
ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com

# ============================================
# CNPJ Features (Validation & Enrichment)
# ============================================
# Master flag - Disable all CNPJ features at once
ENABLE_CNPJ_FEATURES=true

# Validate CNPJ checksum before saving invoices
ENABLE_CNPJ_VALIDATION=true

# Enrich merchant data from BrasilAPI/ReceitaWS public APIs
ENABLE_CNPJ_ENRICHMENT=true

# API timeout in seconds (1-30)
CNPJ_API_TIMEOUT=5

# Cache TTL in seconds (86400 = 24 hours)
CNPJ_CACHE_TTL=86400

# Quick disable examples:
# - Emergency rollback: ENABLE_CNPJ_FEATURES=false
# - Disable validation only: ENABLE_CNPJ_VALIDATION=false
# - Disable enrichment only: ENABLE_CNPJ_ENRICHMENT=false
# - No cache: CNPJ_CACHE_TTL=0
# See FEATURE_FLAGS.md for detailed configuration guide

# ============================================
# Frontend (Next.js)
# ============================================
# API URL for frontend to connect to backend
NEXT_PUBLIC_API_URL=http://localhost:8000
NODE_ENV=development

# ============================================
# Ports (Optional - customize if ports are in use)
# ============================================
# API backend port (default: 8000)
# API_PORT=8000

# Web frontend port (default: 3000)
# WEB_PORT=3000

# Example for custom ports (resolve conflicts):
# API_PORT=8001
# WEB_PORT=3001
# ALLOWED_ORIGINS=http://localhost:3001,http://localhost:8001

# ============================================
# Subscription System (Feature Flag)
# ============================================
# Master flag - Enable subscription limits (invoices/month, AI analyses/month)
ENABLE_SUBSCRIPTION_SYSTEM=false

# Trial duration in days (default: 30)
TRIAL_DURATION_DAYS=30

# ============================================
# Stripe Payment Integration
# ============================================
# Get your keys at: https://dashboard.stripe.com/apikeys
# Test mode: sk_test_... | Production mode: sk_live_...
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Create products/prices in Stripe Dashboard, then paste Price IDs here:
# Básico Mensal (R$ 9,90/mês)
STRIPE_BASIC_MONTHLY_PRICE_ID=price_1234567890BasicMonthly
# Básico Anual (R$ 99/ano)
STRIPE_BASIC_YEARLY_PRICE_ID=price_1234567890BasicYearly
# Premium Mensal (R$ 19,90/mês)
STRIPE_PREMIUM_MONTHLY_PRICE_ID=price_1234567890PremiumMonthly
# Premium Anual (R$ 199/ano)
STRIPE_PREMIUM_YEARLY_PRICE_ID=price_1234567890PremiumYearly

# ============================================
# Mobile In-App Purchases (for future Fase 3)
# ============================================
# Apple IAP - Get your shared secret at: https://appstoreconnect.apple.com
# APPLE_SHARED_SECRET=your_apple_shared_secret
# APPLE_BUNDLE_ID=com.mercadoesperto.app

# Google Play - Service account JSON key path
# GOOGLE_PLAY_PACKAGE_NAME=com.mercadoesperto.app
# GOOGLE_PLAY_SERVICE_ACCOUNT_JSON=/path/to/service-account.json

# ============================================
# Performance
# ============================================
# Uvicorn workers (recommended: 2 * CPU cores + 1)
UVICORN_WORKERS=2

# ============================================
# Deployment (Dokploy)
# ============================================
# 1. Create a "Compose" service in Dokploy
# 2. Use docker-compose.prod.yml as the compose file
# 3. Set all required variables above in Dokploy's Environment tab
# 4. Configure domains:
#    - web service  -> yourdomain.com        (port 3000)
#    - api service  -> api.yourdomain.com    (port 8000)
# 5. ALLOWED_ORIGINS must include the frontend URL (e.g. https://yourdomain.com)
# 6. NEXT_PUBLIC_API_URL must point to the api domain (e.g. https://api.yourdomain.com)
