# ===========================================
# Mercado Esperto - Production Environment
# ===========================================
# Copy this file to .env and fill in the values
# Keep the .env file secure (chmod 600 .env)

# -------------------------------------------
# Domains (Traefik routing)
# -------------------------------------------
API_DOMAIN=api.yourdomain.com
WEB_DOMAIN=yourdomain.com

# -------------------------------------------
# Database (PostgreSQL)
# -------------------------------------------
POSTGRES_USER=mercadoesperto
POSTGRES_PASSWORD=CHANGE_THIS_SECURE_PASSWORD_MIN_32_CHARS
POSTGRES_DB=mercadoesperto
DATABASE_URL=postgresql+asyncpg://mercadoesperto:CHANGE_THIS_SECURE_PASSWORD_MIN_32_CHARS@postgres:5432/mercadoesperto
DB_ECHO=false

# -------------------------------------------
# Cache (Redis)
# -------------------------------------------
REDIS_URL=redis://redis:6379/0

# -------------------------------------------
# JWT Authentication
# -------------------------------------------
# Generate with: openssl rand -hex 32
SECRET_KEY=CHANGE_THIS_SECURE_RANDOM_KEY_MIN_64_CHARS
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# -------------------------------------------
# LLM Providers (at least one required)
# -------------------------------------------
# OpenRouter (recommended - cheapest, best routing)
OPENROUTER_API_KEY=sk-or-v1-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
OPENROUTER_MODEL=google/gemini-2.0-flash-001
OPENROUTER_MODEL_LITE=google/gemini-2.0-flash-lite-preview-02-05
OPENROUTER_MODEL_FULL=google/gemini-2.0-flash-thinking-exp-01-21
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# Google Gemini Direct (optional fallback)
GEMINI_API_KEY=
GEMINI_MODEL=gemini-2.0-flash

# OpenAI (optional fallback)
OPENAI_API_KEY=

# Anthropic Claude (optional fallback)
ANTHROPIC_API_KEY=
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# -------------------------------------------
# CORS & Origins
# -------------------------------------------
# Production: use HTTPS domains only
ALLOWED_ORIGINS=https://yourdomain.com,https://api.yourdomain.com

# -------------------------------------------
# Application
# -------------------------------------------
APP_NAME=Mercado Esperto API
DEBUG=false
UPLOAD_DIR=uploads

# Uvicorn workers: 2 is optimal for 2 vCPU / 2.5GB RAM allocation
# - FastAPI is async/IO-bound â†’ workers don't need to match CPU cores
# - Formula (2*CPU)+1=5 would consume too much memory (~5-6GB)
# - 2 workers balance concurrency with memory efficiency (~1-1.25GB per worker)
UVICORN_WORKERS=2

# -------------------------------------------
# Database Connection Pool (Phase 2 Optimization)
# -------------------------------------------
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=5
DB_POOL_RECYCLE=1800
DB_POOL_TIMEOUT=30

# -------------------------------------------
# LLM Cache & Resilience (Phase 2 Optimization)
# -------------------------------------------
LLM_CACHE_TTL=86400
LLM_TIMEOUT_SECONDS=60

# -------------------------------------------
# Rate Limiting (Phase 2 Optimization)
# -------------------------------------------
RATE_LIMIT_ENABLED=true

# -------------------------------------------
# Image Optimization
# -------------------------------------------
IMAGE_OPTIMIZATION_ENABLED=true
IMAGE_MAX_DIMENSION=1536
IMAGE_JPEG_QUALITY=90

# -------------------------------------------
# AI Analysis Features
# -------------------------------------------
ENABLE_AI_ANALYSIS=true
ENABLE_ANALYSIS_PRICE_ALERT=true
ENABLE_ANALYSIS_CATEGORY_INSIGHT=true
ENABLE_ANALYSIS_MERCHANT_PATTERN=true
ENABLE_ANALYSIS_SUMMARY=true
ENABLE_ANALYSIS_BUDGET_HEALTH=true
ENABLE_ANALYSIS_PER_CAPITA_SPENDING=true
ENABLE_ANALYSIS_ESSENTIAL_RATIO=true
ENABLE_ANALYSIS_INCOME_COMMITMENT=true
ENABLE_ANALYSIS_CHILDREN_SPENDING=true
ENABLE_ANALYSIS_WHOLESALE_OPPORTUNITY=true
ENABLE_ANALYSIS_SHOPPING_FREQUENCY=true
ENABLE_ANALYSIS_SEASONAL_ALERT=true
ENABLE_ANALYSIS_SAVINGS_POTENTIAL=true
ENABLE_ANALYSIS_FAMILY_NUTRITION=true

# -------------------------------------------
# CNPJ Features
# -------------------------------------------
ENABLE_CNPJ_FEATURES=true
ENABLE_CNPJ_VALIDATION=true
ENABLE_CNPJ_ENRICHMENT=true
CNPJ_API_TIMEOUT=5
CNPJ_CACHE_TTL=86400

# -------------------------------------------
# Subscription System (Stripe)
# -------------------------------------------
# Set to true to enable subscription limits
ENABLE_SUBSCRIPTION_SYSTEM=false
TRIAL_DURATION_DAYS=30

# Stripe keys (get from https://dashboard.stripe.com/apikeys)
# Format: sk_live_51... (live) or sk_test_51... (test)
STRIPE_SECRET_KEY=your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret_here

# Stripe Price IDs (get from https://dashboard.stripe.com/prices)
# Format: price_1ABC...
STRIPE_BASIC_MONTHLY_PRICE_ID=your_basic_monthly_price_id
STRIPE_BASIC_YEARLY_PRICE_ID=your_basic_yearly_price_id
STRIPE_PREMIUM_MONTHLY_PRICE_ID=your_premium_monthly_price_id
STRIPE_PREMIUM_YEARLY_PRICE_ID=your_premium_yearly_price_id

# -------------------------------------------
# Admin Bootstrap
# -------------------------------------------
# Email of user to make admin on first startup
ADMIN_BOOTSTRAP_EMAIL=admin@yourdomain.com
ADMIN_BOOTSTRAP_ROLE=super_admin

# -------------------------------------------
# External APIs
# -------------------------------------------
SEFAZ_API_URL=https://www.nfce.fazenda.sp.gov.br/NFCeConsultaPublica

# -------------------------------------------
# Next.js Frontend
# -------------------------------------------
NEXT_PUBLIC_API_URL=https://api.yourdomain.com

# -------------------------------------------
# Apple IAP (Future - Phase 3)
# -------------------------------------------
APPLE_SHARED_SECRET=
APPLE_BUNDLE_ID=com.mercadoesperto.app

# -------------------------------------------
# Google Play (Future - Phase 3)
# -------------------------------------------
GOOGLE_PLAY_PACKAGE_NAME=com.mercadoesperto.app
GOOGLE_PLAY_SERVICE_ACCOUNT_JSON=
